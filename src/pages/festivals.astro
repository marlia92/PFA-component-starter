---
import { getCollection } from 'astro:content';
import FestivalCard from "../components/building-blocks/FestivalCard.astro"; 

pageSections:
  - _component: page-sections/hero
    title: Explore the Pasifika Festivals Network
    subtitle: Connecting communities across Aotearoa.

// 1. Fetch and Sort the Data (Your existing JavaScript logic)
const allFestivals = await getCollection('festivals');
const sortedFestivals = allFestivals.sort((a, b) => 
  a.data.title.localeCompare(b.data.title)
);

// Note: Ensure the "page-sections/hero" component exists at the path you registered in your cloudcannon.config.yaml.
---

<main class="page-container">
    {/* This loop is what renders your component blocks */}
    {pageSections.map((block) => (
        <Fragment set:html={block.componentHtml} />
    ))}
    
    <h1>All Pasifika Festivals</h1>
    
    {sortedFestivals.length === 0 && <p>No festivals have been added yet!</p>}

    <section class="festivals-grid">
        {sortedFestivals.map(festival => (
            <FestivalCard
                title={festival.data.title}
                region={festival.data.region}
                image={festival.data.featuredImage}
                link={`/festivals/${festival.slug}`} 
            />
        ))}
    </section>

</main>
