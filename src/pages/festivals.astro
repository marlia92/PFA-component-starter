---
// 1. Imports
import { getCollection } from 'astro:content';
import FestivalCard from "../components/building-blocks/FestivalCard.astro"; 

// 2. CloudCannon Component Data (Fixed Syntax)
// This is now a valid JavaScript constant that CloudCannon detects as an editable array.
const pageSections = [
  {
    _component: 'page-sections/hero',
    title: 'Explore the Pasifika Festivals Network',
    subtitle: 'Connecting communities across Aotearoa.'
  }
];

// 3. Collection Data Fetching
const allFestivals = await getCollection('festivals');
const sortedFestivals = allFestivals.sort((a, b) => 
  a.data.title.localeCompare(b.data.title)
);
---

<main class="page-container">
    {/* Loop through the component blocks */}
    {pageSections.map((block) => (
        <Fragment set:html={block.componentHtml} />
    ))}
    
    <h1>All Pasifika Festivals</h1>
    
    {sortedFestivals.length === 0 && <p>No festivals have been added yet!</p>}

    <section class="festivals-grid">
        {sortedFestivals.map(festival => (
            <FestivalCard
                title={festival.data.title}
                region={festival.data.region}
                image={festival.data.featuredImage}
                link={`/festivals/${festival.slug}`} 
            />
        ))}
    </section>

</main>
